<body>
  <div
    style="
      display: flex;
      justify-content: space-evenly;
      width: 96%;
      height: 95%;
      padding: 2vh 2vh;
      overflow: hidden;
      align-items: center;
    "
  >
    <button style="height: 50%" onclick="prevPage()"><</button>
    <div
      style="
        flex: 1;
        display: flex;
        position: relative;
        justify-content: center;
      "
    >
      <img
        id="image"
        style="max-width: 100%; max-height: 100%; object-fit: contain"
      />
      <a
        id="link"
        href="#"
        onclick="setGame('select')"
        style="display: none; position: absolute; bottom: 5%; font-size: 4cqh"
      ></a>
    </div>
    <button style="height: 50%" onclick="nextPage()">></button>
  </div>
</body>
<script>
  params = new URLSearchParams(parent.window.location.search);
  currenPdf = gameData.pdf?.map((e) => e.prefix).indexOf(params.get("pdf"));
  if (currenPdf === -1) {
    currenPdf = 0;
  }

  path = gameData.pdf[currenPdf].path;
  prefix = gameData.pdf[currenPdf].prefix;
  ext = gameData.pdf[currenPdf].ext;
  size = gameData.pdf[currenPdf].size;

  viewer = document.getElementById("image");
  viewer.src = path + "/" + prefix + 1 + ext;

  link = document.getElementById("link");

  link.innerHTML = gameData.pdf[currenPdf].button;
  link.href = gameData.pdf[currenPdf].href || "#";
  link.target = gameData.pdf[currenPdf].href ? "_blank" : "_self";

  currentIndex = 1;
  xDown = null;

  viewer.addEventListener("touchstart", handleTouchStart, false);
  viewer.addEventListener("touchmove", handleTouchMove, false);

  function handleTouchStart(evt) {
    firstTouch = evt.touches[0];
    xDown = firstTouch.clientX;
  }

  function handleTouchMove(evt) {
    evt.preventDefault();
    if (!xDown) return;

    xUp = evt.touches[0].clientX;
    xDiff = xDown - xUp;

    if (xDiff > 0) {
      nextPage();
    } else {
      prevPage();
    }

    xDown = null;
  }

  function nextPage() {
    if (currentIndex < size) {
      currentIndex++;
      viewer.src = path + "/" + prefix + currentIndex + ext;
      if (currentIndex === size) {
        link.style.display = "block";
      }
    }
  }

  function prevPage() {
    if (currentIndex > 1) {
      currentIndex--;
      viewer.src = path + "/" + prefix + currentIndex + ext;
      if (currentIndex != size) {
        link.style.display = "none";
      }
    }
  }
</script>
